<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>K1000 MAIM</title>
        <meta
            name="viewport"
            content="viewport-fit=cover, width=device-width, initial-scale=1.0, user-scalable=no"
        />
    </head>
    <body>
        <header>
            <svg id="logo" viewBox="0 0 400 108">
                <path
                    d="M166.245 106.861C163.972 106.047 162.9 104.295 162.928 101.441C162.967 97.4232 165.842 94.6372 169.949 94.6372C172.627 94.6372 174.318 95.7062 175.276 98.0047C176.103 99.9896 176.04 101.089 174.971 103.302C173.465 106.421 169.516 108.031 166.245 106.861ZM170.127 105.673C173.381 104.738 175.169 101.356 173.952 98.4375C173.2 96.6315 172.115 95.9603 169.95 95.9603C166.667 95.9603 164.336 98.239 164.264 101.518C164.222 103.467 165.174 104.993 166.864 105.687C168.053 106.174 168.388 106.173 170.127 105.674V105.673ZM198.711 106.931C198.081 106.701 197.346 106.032 197.078 105.442C196.366 103.875 197.263 103.58 198.539 104.961C199.765 106.287 200.197 106.361 201.146 105.411C202.283 104.27 201.948 102.757 200.077 100.591C198.126 98.3304 197.803 96.5641 199.122 95.3671C200.679 93.9549 204.037 94.9112 204.037 96.7668C204.037 97.499 202.928 97.4076 202.277 96.6217C201.229 95.3558 199.638 96.0483 199.638 97.7702C199.638 97.9983 200.469 99.0892 201.485 100.194C202.91 101.744 203.333 102.552 203.333 103.723C203.333 106.205 201.057 107.785 198.711 106.931V106.931ZM292.112 106.997C286.65 105.683 286.322 98.0244 291.61 95.2829C294.125 93.9791 299.938 94.9287 299.938 96.6434C299.938 97.603 299.399 97.6506 298.027 96.8121C296.327 95.7728 293.67 95.7149 292.037 96.6816C289.167 98.3811 288.35 102.542 290.494 104.535C292.012 105.945 294.218 106.3 296.229 105.458C298.22 104.624 298.618 104.612 298.618 105.389C298.618 106.565 294.523 107.577 292.112 106.997V106.997ZM70.8449 105.993C71.1988 105.448 72.8278 102.659 74.4649 99.7958C76.102 96.9329 77.5221 94.6714 77.6206 94.7702C77.9891 95.1396 81.7232 106.709 81.5349 106.898C81.0023 107.432 80.0904 106.445 79.6002 104.805L79.0529 102.974L76.5538 103.105C74.1148 103.234 74.03 103.282 73.0256 105.111C72.3362 106.367 71.7001 106.986 71.099 106.986C70.2709 106.986 70.2512 106.909 70.8449 105.993H70.8449ZM77.9206 99.672L77.2335 97.6506L76.1876 99.4965C75.6124 100.512 75.1417 101.421 75.1417 101.518C75.1417 101.615 75.9216 101.693 76.8747 101.693H78.6077L77.9206 99.672ZM103.969 104.229C104.135 102.713 104.497 99.9845 104.774 98.1653L105.276 94.8577H108.539C110.758 94.8577 111.86 95.034 111.985 95.409C112.119 95.8128 111.393 95.9602 109.272 95.9602C107.108 95.9602 106.376 96.1136 106.376 96.5666C106.376 96.9002 106.252 97.7932 106.101 98.5512L105.826 99.9294H108.52C110.622 99.9294 111.215 100.075 111.215 100.591C111.215 101.111 110.604 101.252 108.355 101.252H105.496V102.76C105.496 103.589 105.376 104.581 105.229 104.965C105.003 105.554 105.379 105.663 107.648 105.663C109.743 105.663 110.335 105.808 110.335 106.324C110.335 106.854 109.671 106.986 107.001 106.986H103.666L103.969 104.229ZM132.965 106.029C133.09 105.464 133.403 103.314 133.66 101.252C133.917 99.1907 134.244 96.8369 134.387 96.0217L134.646 94.5396L137.211 94.7256C140.151 94.9389 141.569 95.9091 141.569 97.7083C141.569 99.2747 140.643 100.453 138.969 101.018L137.591 101.484L139.129 103.904C140.842 106.6 140.961 106.986 140.081 106.986C139.746 106.986 138.634 105.696 137.61 104.119C136.585 102.542 135.589 101.252 135.397 101.252C135.204 101.252 134.881 102.49 134.679 104.003C134.395 106.118 134.128 106.789 133.523 106.905C132.902 107.025 132.784 106.841 132.965 106.029V106.029ZM139.271 99.2428C141.098 97.96 139.962 95.9602 137.405 95.9602C135.818 95.9602 135.41 96.5093 135.41 98.6424C135.41 99.8026 135.552 99.9294 136.852 99.9294C137.645 99.9294 138.734 99.6204 139.271 99.2428V99.2428ZM225.745 105.552C225.883 104.764 226.206 102.432 226.462 100.37C227.248 94.0625 226.946 94.5085 230.286 94.7217C233.496 94.9267 234.391 95.6038 234.391 97.8286C234.391 99.8886 232.654 101.252 230.032 101.252H227.832L227.562 102.906C226.965 106.571 226.823 106.986 226.168 106.986C225.65 106.986 225.552 106.655 225.745 105.552V105.552ZM232.267 99.1995C233.976 97.6482 232.799 95.9602 230.007 95.9602C228.592 95.9602 228.471 96.1181 228.061 98.4961C227.815 99.9225 227.823 99.9294 229.638 99.9294C230.718 99.9294 231.79 99.6316 232.267 99.1995ZM255.169 105.993C255.523 105.448 257.152 102.659 258.789 99.7958C260.426 96.9329 261.846 94.6714 261.945 94.7702C262.313 95.1396 266.047 106.709 265.859 106.898C265.326 107.432 264.415 106.445 263.924 104.805L263.377 102.974L260.878 103.105C258.439 103.234 258.354 103.282 257.35 105.111C256.66 106.367 256.024 106.986 255.423 106.986C254.595 106.986 254.575 106.909 255.169 105.993H255.169ZM262.245 99.672L261.558 97.6506L260.512 99.4965C259.937 100.512 259.466 101.421 259.466 101.518C259.466 101.615 260.246 101.693 261.199 101.693H262.932L262.245 99.672ZM321.726 104.229C321.893 102.713 322.255 99.9845 322.531 98.1653L323.034 94.8577H326.296C328.515 94.8577 329.618 95.034 329.742 95.409C329.877 95.8128 329.151 95.9602 327.029 95.9602C324.865 95.9602 324.133 96.1136 324.133 96.5666C324.133 96.9002 324.01 97.7932 323.858 98.5512L323.584 99.9294H326.278C328.38 99.9294 328.972 100.075 328.972 100.591C328.972 101.111 328.361 101.252 326.113 101.252H323.254V102.76C323.254 103.589 323.133 104.581 322.987 104.965C322.761 105.554 323.137 105.663 325.406 105.663C327.501 105.663 328.093 105.808 328.093 106.324C328.093 106.854 327.429 106.986 324.758 106.986H321.424L321.726 104.229ZM0.356275 101.029C0.356275 100.442 3.65034 100.377 28.3642 100.477C50.2984 100.566 56.4119 100.71 56.5554 101.142C56.7007 101.579 50.9049 101.693 28.5475 101.693C3.72038 101.693 0.356275 101.614 0.356275 101.029V101.029ZM343.05 101.029C343.05 100.442 346.344 100.377 371.058 100.477C392.992 100.566 399.105 100.71 399.249 101.142C399.394 101.579 393.598 101.693 371.241 101.693C346.414 101.693 343.05 101.614 343.05 101.029V101.029ZM104.485 87.8269C101.751 86.8492 99.458 85.0783 98.2498 83.0116C96.7271 80.4067 96.1786 74.1549 96.3488 61.3406L96.4776 51.6383L99.8869 51.5095L103.296 51.3807L103.328 62.9759C103.367 76.9215 103.59 78.9625 105.231 80.3773C106.688 81.6342 110.024 81.7966 111.603 80.6876C113.68 79.2293 113.854 77.9562 113.854 64.2214V51.4178H117.406H120.958L120.815 65.6405C120.677 79.4598 120.644 79.9219 119.657 81.93C119.099 83.0668 117.873 84.6928 116.934 85.5435C114.03 88.1738 108.362 89.2134 104.485 87.8269H104.485ZM132.868 87.8139C131.833 87.4899 130.278 86.6833 129.413 86.0215C127.786 84.7781 125.169 81.0799 125.517 80.5163C125.625 80.3405 126.94 79.4643 128.439 78.569C130.73 77.2012 131.225 77.0475 131.537 77.6067C132.484 79.3033 134.251 80.9497 135.607 81.3982C138.607 82.3907 141.703 79.8909 140.712 77.277C140.495 76.7041 138.669 74.7691 136.654 72.9771C128.726 65.9257 127.081 63.6819 127.061 59.8922C127.034 54.5604 131.02 50.8185 136.73 50.8153C140.256 50.8136 142.79 51.8899 145.493 54.5391L147.437 56.4447L144.877 58.7772L142.317 61.1096L140.413 59.3504C139.05 58.0915 138.123 57.5921 137.151 57.5921C135.173 57.5921 134.09 58.3204 134.09 59.6502C134.09 60.8781 134.84 61.6877 141.872 68.0545C146.642 72.3729 147.728 74.2689 147.728 78.2821C147.728 81.5256 146.916 83.5159 144.722 85.652C142.099 88.2056 137.056 89.1259 132.868 87.815V87.8139ZM0.356275 69.4984V51.4168H3.86318H7.37008L7.49247 57.4221L7.61486 63.4275L12.3421 57.4221L17.0693 51.4168H21.2763C24.5254 51.4168 25.4079 51.5423 25.152 51.968C24.9697 52.2712 22.3267 55.6946 19.2786 59.5755C16.2305 63.4565 13.5839 66.8813 13.3973 67.1863C13.1811 67.5395 15.395 71.1184 19.4966 77.0463C23.0379 82.1644 26.041 86.6282 26.1703 86.9659C26.3611 87.4642 25.6297 87.5773 22.2891 87.5658L18.1728 87.5528L12.8938 79.8238L7.61486 72.0949L7.49473 79.838L7.3746 87.5811H3.86544H0.35627L0.356275 69.4984ZM31.5902 69.4984V51.4168L36.3193 51.4256C45.8852 51.4433 49.3628 52.611 51.6862 56.5854C52.7417 58.3909 52.9122 59.1525 52.8986 61.9977C52.8812 65.602 52.3216 67.1126 50.2174 69.2342C49.5296 69.9278 48.4224 70.6873 47.7571 70.922C47.0917 71.1568 46.5496 71.4783 46.5524 71.6365C46.5549 71.7946 48.3368 75.2746 50.5116 79.3697C52.6864 83.4649 54.4658 86.9875 54.4658 87.1977C54.4658 87.4079 52.7961 87.5801 50.7555 87.5801H47.0451L43.5212 80.8546C38.3252 70.9381 38.6593 70.9986 38.6428 79.9726L38.6288 87.5801H35.1095H31.5902L31.5902 69.4984ZM45.2027 64.4493C46.3481 63.4101 46.3889 61.1243 45.2863 59.7593C44.6154 58.9287 43.9318 58.7088 41.5471 58.5565L38.6288 58.3702V62.0011V65.632L41.4634 65.451C43.417 65.3263 44.5791 65.015 45.2027 64.4493V64.4493ZM57.1297 87.0465C57.1432 86.7335 60.1724 78.6384 63.8613 69.0574L70.5684 51.6373L74.1368 51.5098L77.7052 51.3823L78.5835 53.7149C79.0665 54.9978 82.1521 63.0554 85.4402 71.6207C88.7283 80.186 91.4186 87.2808 91.4186 87.387C91.4186 87.4932 89.781 87.5799 87.7795 87.5799H84.1403L82.7893 83.9416L81.4383 80.3032H74.2462H67.054L65.6447 83.8313L64.2354 87.3594L60.6703 87.4876C57.9765 87.5844 57.1112 87.4771 57.1297 87.0466V87.0465ZM78.5535 72.9162C76.2545 66.6343 74.4351 62.0104 74.2606 62.0063C74.0395 62.0011 69.8628 72.6018 69.8628 73.1681C69.8628 73.3328 71.8636 73.4675 74.309 73.4675C77.6803 73.4675 78.7064 73.3342 78.5535 72.9162V72.9162ZM170.163 69.4994V51.4178H173.683H177.202V58.2535V65.0893H183.141H189.08V58.2535V51.4178H192.599H196.118V69.4994V87.581H192.609H189.1L188.98 79.753L188.86 71.925H183.141H177.422L177.302 79.753L177.182 87.581H173.672H170.163V69.4994ZM200.982 87.0476C200.995 86.7346 204.024 78.6394 207.713 69.0584L214.421 51.6383L217.989 51.5108L221.557 51.3834L222.436 53.7159C222.919 54.9988 226.004 63.0564 229.292 71.6217C232.58 80.187 235.271 87.2818 235.271 87.388C235.271 87.4942 233.633 87.581 231.631 87.581H227.992L226.641 83.9426L225.29 80.3042H218.098H210.906L209.497 83.8324L208.087 87.3605L204.522 87.4886C201.829 87.5855 200.963 87.4782 200.982 87.0476V87.0476ZM222.406 72.9173C220.107 66.6353 218.287 62.0115 218.113 62.0074C217.892 62.0022 213.715 72.6029 213.715 73.1692C213.715 73.3338 215.716 73.4685 218.161 73.4685C221.532 73.4685 222.558 73.3353 222.406 72.9173ZM237.91 87.2743C237.91 86.8306 243.561 53.7273 243.865 52.3918C244.084 51.4311 244.262 51.3875 247.491 51.5098L250.888 51.6383L254.835 63.656C257.006 70.2657 258.889 75.6736 259.02 75.6736C259.151 75.6736 261.052 70.2657 263.244 63.656L267.229 51.6383L270.593 51.5098C273.789 51.3876 273.969 51.4318 274.184 52.3918C274.309 52.9476 275.616 60.646 277.088 69.4994C278.56 78.3528 279.871 86.043 280.001 86.5887C280.231 87.5541 280.143 87.581 276.755 87.581H273.274L271.615 77.5479C270.703 72.0297 269.842 67.1179 269.702 66.6328C269.531 66.0404 268.751 67.8507 267.324 72.1455C266.156 75.6626 264.479 80.5826 263.598 83.0788L261.997 87.6174L258.897 87.489L255.797 87.3606L252.167 76.5558C250.171 70.6131 248.512 65.8502 248.481 65.9714C248.45 66.0927 247.593 70.9549 246.577 76.7763L244.729 87.3606L241.319 87.4896C239.444 87.5604 237.91 87.4635 237.91 87.2747V87.2743ZM284.981 69.4348V51.2886L292.35 51.5369C301.445 51.8432 304.469 52.6376 307.731 55.5781C315.076 62.1985 315.442 76.3204 308.451 83.3243C305.017 86.7638 301.789 87.5724 291.47 87.5777L284.981 87.5803V69.4348ZM300.422 80.0246C304.098 78.7953 306.271 74.994 306.3 69.7433C306.315 67.1483 306.098 66.1943 304.997 63.9867C303.118 60.2191 300.874 58.9035 295.785 58.5852L292.02 58.3497V69.4372V80.5248H295.473C297.373 80.5248 299.6 80.2997 300.422 80.0246V80.0246ZM317.119 87.0476C317.132 86.7346 320.162 78.6394 323.851 69.0584L330.558 51.6383L334.126 51.5108L337.695 51.3834L338.573 53.7159C339.056 54.9988 342.142 63.0564 345.43 71.6217C348.718 80.187 351.408 87.2818 351.408 87.388C351.408 87.4942 349.77 87.581 347.769 87.581H344.13L342.779 83.9426L341.428 80.3042H334.236H327.044L325.634 83.8324L324.225 87.3605L320.66 87.4886C317.966 87.5855 317.101 87.4782 317.119 87.0476V87.0476ZM338.543 72.9173C336.244 66.6353 334.425 62.0115 334.25 62.0074C334.029 62.0022 329.852 72.6029 329.852 73.1692C329.852 73.3338 331.853 73.4685 334.299 73.4685C337.67 73.4685 338.696 73.3353 338.543 72.9173ZM356.247 69.4994V51.4178H359.563H362.878L369.858 62.1124C373.698 67.9944 377.146 73.2039 377.521 73.689C378.143 74.4927 378.205 73.5409 378.223 62.9759L378.244 51.3807L381.653 51.5095L385.063 51.6383L385.178 69.6097L385.292 87.581H381.821H378.351L370.929 76.1568L363.507 64.7327L363.389 76.1568L363.272 87.581H359.76H356.248L356.247 69.4994ZM392.32 69.4994V51.4178H395.839H399.359V69.4994V87.581H395.839H392.32V69.4994ZM75.9288 32.271L56.2599 19.361L34.7968 13.5469C12.6529 7.5484 10.2406 6.82883 13.3338 7.14478C14.3016 7.24365 20.8343 7.72691 27.8509 8.21871L40.6085 9.1129L72.6531 16.6254C90.2776 20.7573 104.935 24.0465 105.226 23.9347C105.516 23.823 108.11 18.637 110.989 12.4103C113.868 6.18355 116.344 1.01463 116.49 0.923775C116.637 0.832933 119.123 5.92096 122.014 12.2305C124.906 18.5401 127.513 23.805 127.807 23.9304C128.102 24.0558 142.751 20.7798 160.361 16.6504L192.379 9.14246L205.424 8.19323C212.599 7.67115 218.916 7.30989 219.461 7.39044C220.006 7.471 210.672 10.1875 198.717 13.427L176.982 19.3172L157.148 32.2804L137.314 45.2436L116.456 45.2123L95.5978 45.1811L75.9288 32.271Z"
                    fill="white"
                />
            </svg>
            <h1>K1000 MAIM</h1>
        </header>
        <main>
            <section id="system">
                <h2>System</h2>
                <dl>
                    <dt>Voltage</dt>
                    <dd class="voltage"></dd>
                    <dt>Current</dt>
                    <dd class="current"></dd>
                    <dt>Power</dt>
                    <dd class="power"></dd>
                </dl>

                <button>Zeroize</button>
                <button>Calibrate INS</button>
                <form>
                    <dl>
                        <dt>Console Forward</dt>
                        <dd>
                            <input
                                type="checkbox"
                                checked
                                name="consoleForward"
                            />
                        </dd>
                        <dt>Console Forward IP</dt>
                        <dd>
                            <input
                                type="text"
                                value=""
                                name="consoleForwardIp"
                                disabled
                            />
                        </dd>
                        <dt>Console Forward Port</dt>
                        <dd>
                            <input
                                type="number"
                                value=""
                                name="consoleForwardPort"
                                disabled
                            />
                        </dd>
                        <dt>Maintenance Port</dt>
                        <dd class="radio">
                            <label
                                ><input
                                    type="radio"
                                    value="none"
                                    checked
                                    name="maintenancePort"
                                />None</label
                            >
                            <label
                                ><input
                                    type="radio"
                                    value="payload 1"
                                    name="maintenancePort"
                                />Payload 1</label
                            >
                            <label
                                ><input
                                    type="radio"
                                    value="payload 2"
                                    name="maintenancePort"
                                />Payload 2</label
                            >
                            <label
                                ><input
                                    type="radio"
                                    value="aircraft"
                                    name="maintenancePort"
                                />Aircraft</label
                            >
                            <label
                                ><input
                                    type="radio"
                                    value="ahrs"
                                    name="maintenancePort"
                                />AHRS</label
                            >
                            <label
                                ><input
                                    type="radio"
                                    value="slcan"
                                    name="maintenancePort"
                                />SLCAN</label
                            >
                        </dd>
                        <dt></dt>
                        <dd><button type="submit">Save</button></dd>
                    </dl>
                </form>
            </section>
            <section id="payload1">
                <h2>Payload 1</h2>
                <dl>
                    <dt>Voltage</dt>
                    <dd class="voltage">12V</dd>
                    <dt>Current</dt>
                    <dd class="current">1.2A</dd>
                    <dt>Power</dt>
                    <dd class="power">10W</dd>
                </dl>
                <form>
                    <dl>
                        <dt>Enabled</dt>
                        <dd>
                            <input type="checkbox" checked name="enabled" />
                        </dd>
                        <dt>IP</dt>
                        <dd>
                            <input type="text" value="127.0.0.1" name="ip" />
                        </dd>
                        <dt>Netmask</dt>
                        <dd>
                            <input
                                type="text"
                                value="255.0.0.0"
                                name="netmask"
                            />
                        </dd>
                        <dt>Gateway</dt>
                        <dd>
                            <input type="text" value="1.1.1.1" name="gateway" />
                        </dd>
                        <dt></dt>
                        <dd><button type="submit">Save</button></dd>
                    </dl>
                </form>
            </section>
            <section id="payload2">
                <h2>Payload 2</h2>
                <dl>
                    <dt>Voltage</dt>
                    <dd class="voltage">12V</dd>
                    <dt>Current</dt>
                    <dd class="current">1.2A</dd>
                    <dt>Power</dt>
                    <dd class="power">10W</dd>
                </dl>
                <form>
                    <dl>
                        <dt>Enabled</dt>
                        <dd>
                            <input type="checkbox" checked name="enabled" />
                        </dd>
                        <dt>IP</dt>
                        <dd>
                            <input type="text" value="127.0.0.1" name="ip" />
                        </dd>
                        <dt>Netmask</dt>
                        <dd>
                            <input
                                type="text"
                                value="255.0.0.0"
                                name="netmask"
                            />
                        </dd>
                        <dt>Gateway</dt>
                        <dd>
                            <input type="text" value="1.1.1.1" name="gateway" />
                        </dd>
                        <dt></dt>
                        <dd><button type="submit">Save</button></dd>
                    </dl>
                </form>
            </section>
        </main>

        <style>
            body {
                margin: 4rem;
                background: #161616;
                color: white;
                font-family: sans-serif;
            }

            #logo {
                width: 8rem;
            }

            h1 {
                margin-bottom: 2rem;
            }

            h2 {
                margin-bottom: 2rem;
            }

            dl {
                display: grid;
                grid-gap: 0.5rem 1rem;
                grid-template-columns: auto auto;
                align-items: center;
                width: 10rem;
                margin-bottom: 3rem;
            }

            dl dt {
                white-space: nowrap;
            }

            input[type="text"],
            input[type="number"] {
                background: black;
                border: 1px solid white;
                color: white;
                padding: 0.5rem 1rem;
                font-size: 1rem;
            }

            input[type="text"][disabled],
            input[type="number"][disabled] {
                color: #666;
            }

            .radio {
                display: grid;
                grid-gap: 0.25rem;
                grid-template-columns: auto;
            }

            .radio label {
                cursor: pointer;
            }

            input[type="radio"] {
                margin-right: 0.5rem;
            }

            button {
                background: black;
                border: 1px solid white;
                color: white;
                padding: 0.5rem 1rem;
                margin-top: 2rem;
                font-size: 1rem;
                cursor: pointer;
            }
        </style>
        <script>
            let state = {
                system: {
                    voltage: 0,
                    current: 0,
                },
                payload1: {
                    voltage: 0,
                    current: 0,
                },
                payload2: {
                    voltage: 0,
                    current: 0,
                },
            };

            let configuration = {
                system: {
                    maintenancePort: "none",
                    consoleForward: {
                        enabled: true,
                        ip: "0.0.0.0",
                        port: 0,
                    },
                },
                payload1: {
                    enabled: true,
                    ip: "0.0.0.0",
                    netmask: "0.0.0.0",
                    gateway: "0.0.0.0",
                },
                payload2: {
                    enabled: true,
                    ip: "0.0.0.0",
                    netmask: "0.0.0.0",
                    gateway: "0.0.0.0",
                },
            };

            initializeSystem();
            initializePayload1();
            initializePayload2();

            function initializeSystem() {
                const form = document.querySelector("#system form");

                form.consoleForward.onchange = (event) => {
                    configuration.system.consoleForward.enabled =
                        event.target.checked;
                    update();
                };
                form.consoleForwardIp.onchange = (event) => {
                    configuration.system.consoleForward.ip = event.target.value;
                    update();
                };
                form.consoleForwardPort.onchange = (event) => {
                    configuration.system.consoleForward.port = parseInt(
                        event.target.value
                    );
                    update();
                };
                form.maintenancePort.forEach(
                    (_) =>
                        (_.onchange = (event) => {
                            if (_.checked)
                                configuration.system.maintenancePort = _.value;
                            update();
                        })
                );
                form.onsubmit = (event) => {
                    event.preventDefault();
                    save();
                };
            }

            function initializePayload1() {
                const form = document.querySelector("#payload1 form");

                form.enabled.onchange = (event) => {
                    configuration.payload1.enabled = event.target.checked;
                    update();
                };
                form.ip.onchange = (event) => {
                    configuration.payload1.ip = event.target.value;
                    update();
                };
                form.netmask.onchange = (event) => {
                    configuration.payload1.netmask = event.target.value;
                    update();
                };
                form.gateway.onchange = (event) => {
                    configuration.payload1.gateway = event.target.value;
                    update();
                };
                form.onsubmit = (event) => {
                    event.preventDefault();
                    save();
                };
            }

            function initializePayload2() {
                const form = document.querySelector("#payload2 form");

                form.enabled.onchange = (event) => {
                    configuration.payload2.enabled = event.target.checked;
                    update();
                };
                form.ip.onchange = (event) => {
                    configuration.payload2.ip = event.target.value;
                    update();
                };
                form.netmask.onchange = (event) => {
                    configuration.payload2.netmask = event.target.value;
                    update();
                };
                form.gateway.onchange = (event) => {
                    configuration.payload2.gateway = event.target.value;
                    update();
                };
                form.onsubmit = (event) => {
                    event.preventDefault();
                    save();
                };
            }

            async function load() {
                const response = await fetch("configuration");
                configuration = await response.json();
                update();
            }

            async function save() {
                const params = new URLSearchParams();

                const step = (value, key) => {
                    if (typeof value === "object")
                        Object.keys(value).forEach((k) =>
                            step(value[k], key ? `${key}.${k}` : k)
                        );
                    else params.append(key, value);
                };

                step(configuration);

                await fetch("configuration?" + params);
            }

            async function refresh() {
                const response = await fetch("state");
                state = await response.json();
                updateState();
            }

            function update() {
                updateSystem();
                updatePayload1();
                updatePayload2();
            }

            function updateState() {
                updateSystemState();
                updatePayload1State();
                updatePayload2State();
            }

            function updateSystemState() {
                const { voltage, current } = state.system;
                const power = voltage * current;
                const system = document.querySelector("#system");
                system.querySelector(
                    ".voltage"
                ).textContent = `${voltage.toFixed(1)}V`;
                system.querySelector(
                    ".current"
                ).textContent = `${current.toFixed(1)}A`;
                system.querySelector(".power").textContent = `${power.toFixed(
                    1
                )}W`;
            }

            function updateSystem() {
                const { consoleForward, maintenancePort } =
                    configuration.system;
                const form = document.querySelector("#system form");
                form.consoleForward.checked = consoleForward.enabled;
                form.consoleForwardIp.disabled = !consoleForward.enabled;
                form.consoleForwardPort.disabled = !consoleForward.enabled;
                form.consoleForwardIp.value = consoleForward.ip;
                form.consoleForwardPort.value = consoleForward.port;
                form.maintenancePort.forEach((_) => {
                    _.checked = maintenancePort === _.value;
                });
            }

            function updatePayload1State() {
                const { voltage, current } = state.payload1;
                const power = voltage * current;
                const payload1 = document.querySelector("#payload1");
                payload1.querySelector(
                    ".voltage"
                ).textContent = `${voltage.toFixed(1)}V`;
                payload1.querySelector(
                    ".current"
                ).textContent = `${current.toFixed(1)}A`;
                payload1.querySelector(".power").textContent = `${power.toFixed(
                    1
                )}W`;
            }

            function updatePayload1() {
                const { enabled, ip, netmask, gateway } =
                    configuration.payload1;
                const form = payload1.querySelector("#payload1 form");
                form.enabled.checked = enabled;
                form.ip.disabled = !enabled;
                form.netmask.disabled = !enabled;
                form.gateway.disabled = !enabled;
                form.ip.value = ip;
                form.netmask.value = netmask;
                form.gateway.value = gateway;
            }

            function updatePayload2State() {
                const { voltage, current } = state.payload2;
                const power = voltage * current;
                const payload2 = document.querySelector("#payload2");
                payload2.querySelector(
                    ".voltage"
                ).textContent = `${voltage.toFixed(1)}V`;
                payload2.querySelector(
                    ".current"
                ).textContent = `${current.toFixed(1)}A`;
                payload2.querySelector(".power").textContent = `${power.toFixed(
                    1
                )}W`;
            }

            function updatePayload2() {
                const { enabled, ip, netmask, gateway } =
                    configuration.payload2;
                const form = payload2.querySelector("#payload2 form");
                form.enabled.checked = enabled;
                form.ip.disabled = !enabled;
                form.netmask.disabled = !enabled;
                form.gateway.disabled = !enabled;
                form.ip.value = ip;
                form.netmask.value = netmask;
                form.gateway.value = gateway;
            }

            setInterval(refresh, 100);

            load();
        </script>
    </body>
</html>
